---
layout: post
title: 动态代理的一点理解
category: tech
---

今天想到mybatis的interface+mapper.xml配置生成的DAO层代码，想到这应该是动态代理来做的，顺便复习一下吧。

实际上，整个思维的跳跃性应该是这样的

* mybatis
-- 动态代理
*** 动态代理的两种实现方式
**** proxy方式
**** cglib方式
*** 动态代理应用场景
** 静态代理
*** 代理模式
** 动态代理和静态代理的区别，特性
** 动态代理有什么优势

其实说到他们的区别，就要先看他们的特性，以及依赖他们特性的应用场景

静态代理是通过实现相同接口，持有代理对象的实例，实现了代理效果

异同点

1. 静态代理持有了指定的代理对象，对相关的方法进行包装；动态代理同样持有invocationHandler，而handler就是相当于为动态代理对象增加了一个可控的invoke方法，如果我们直接用invoke的话，执行的就是已经定义的方法，但对象持有了handler后，我们可以通过handler中的invoke方法对其进行包装操作
2. 其实两个从宏观上，没有什么不同，一个是持有真正的对象，一个是持有对象的反射方法入口，本质上都可以对方法进行二次封装（如AOP操作等）；但具体实现上，又有很大不同，静态代理，在编译阶段就已经全部完成，我们既可以面向接口，也可以面向对象本身；动态代理在执行过程中进行连接，本质上是利用了jdk提供的接口，让反射灵活的植入到了对象方法的调用中，这种是必须面向接口的调用，抽象层次更高一些，我们关心的是handler，而不是一个具体的对象，很多场景下，我们需要的是植入通用的方法，而不是针对每一个对象的具体业务做代理，因此动态代理在这一方面更具优势，个人认为甚至超过了运行期编译等特征（运行期形成class这个只能说是一个特征，而不能说是优势，完全看不出有什么优势），便于框架式编写
